<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOD Realtime â€” Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memanggil library Supabase untuk browser -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #020617; color: white; font-family: sans-serif; overflow-x: hidden; }
        .glass { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 28px; }
        .btn-tap:active { transform: scale(0.95); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="p-6 flex flex-col items-center min-h-screen">

    <!-- LOGIN -->
    <div id="view-login" class="w-full max-w-sm mt-16 space-y-8 text-center">
        <div class="space-y-2">
            <h1 class="text-5xl font-black italic text-indigo-500 tracking-tighter">TOD LIVE</h1>
            <p id="status-db" class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Checking Connection...</p>
        </div>
        <div class="glass p-8 space-y-4 shadow-2xl">
            <input id="input-nama" type="text" placeholder="Siapa namamu?" class="w-full p-4 rounded-xl bg-slate-900 border-none text-white text-center font-bold text-lg outline-none focus:ring-2 ring-indigo-500">
            <button onclick="masukGame()" class="w-full bg-indigo-600 p-4 rounded-xl font-black uppercase tracking-widest btn-tap">Main Sekarang</button>
        </div>
    </div>

    <!-- GAME AREA -->
    <div id="view-game" class="hidden w-full max-w-md space-y-6">
        <div class="glass p-10 text-center relative overflow-hidden">
            <div id="disp-tipe" class="text-[10px] font-black text-indigo-400 uppercase tracking-[0.5em] mb-4">Siap Bermain?</div>
            <h2 id="disp-isi" class="text-2xl font-bold italic mb-6 leading-tight">"Menunggu kartu..."</h2>
            <p id="disp-pembuat" class="text-[10px] text-white/20 font-bold uppercase"></p>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <button onclick="pilih('TRUTH')" class="bg-indigo-600/20 border border-indigo-500/30 p-6 rounded-3xl font-black text-indigo-400 btn-tap uppercase">TRUTH</button>
            <button onclick="pilih('DARE')" class="bg-rose-600/20 border border-rose-500/30 p-6 rounded-3xl font-black text-rose-400 btn-tap uppercase">DARE</button>
        </div>

        <div class="glass p-6 h-64 flex flex-col">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-white/5">
                <span class="text-[10px] font-black text-white/30 uppercase tracking-widest">Aktivitas Realtime</span>
                <div class="flex items-center gap-1.5">
                    <div class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-[8px] font-bold text-green-500 uppercase">Live</span>
                </div>
            </div>
            <div id="log-list" class="flex-1 overflow-y-auto space-y-3 no-scrollbar"></div>
        </div>
    </div>

    <script>
        // DATA SESUAI PERMINTAANMU
        const SB_URL = 'https://rruxlxoeelxjjjmhafkc.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJydXhseG9lZWx4ampqbWhhZmtjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NDU5OTMsImV4cCI6MjA4NTMyMTk5M30.oR2hl_BDD1P6Dmtos2So-aJ_eoFl1-Kwybt6mQnvq0Q';

        const supabaseClient = supabase.createClient(SB_URL, SB_KEY);
        let userNama = "";

        const DATA_SOAL = {
            TRUTH: ["Pernah naksir siapa di grup ini?", "Apa kebohongan terbesarmu?", "Chat terakhir di WA sama siapa?", "Momen paling malu-maluin?"],
            DARE: ["Tiru suara ayam jago!", "Post foto aib di WA!", "Chat crush kamu 'P'!", "Dance tanpa musik 30 detik!"]
        };

        // Cek koneksi di awal
        async function checkDB() {
            const { error } = await supabaseClient.from('Tantangan').select('id').limit(1);
            const status = document.getElementById('status-db');
            if (error) {
                status.innerText = "Error: RLS is ON or Table Missing";
                status.classList.add('text-rose-500');
            } else {
                status.innerText = "Database Connected";
                status.classList.add('text-green-500');
            }
        }
        checkDB();

        function masukGame() {
            userNama = document.getElementById('input-nama').value.trim();
            if (!userNama) return alert("Isi namamu!");

            document.getElementById('view-login').classList.add('hidden');
            document.getElementById('view-game').classList.remove('hidden');

            // Aktifkan Realtime
            supabaseClient.channel('any').on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'Tantangan' }, p => {
                updateUI(p.new);
            }).subscribe();

            loadHistory();
        }

        async function pilih(tipe) {
            const soal = DATA_SOAL[tipe][Math.floor(Math.random() * DATA_SOAL[tipe].length)];
            const { error } = await supabaseClient.from('Tantangan').insert([{ tipe, isi: soal, pembuat: userNama }]);
            if (error) alert("Gagal kirim data ke Supabase!");
        }

        async function loadHistory() {
            const { data } = await supabaseClient.from('Tantangan').select('*').order('id', { ascending: false }).limit(5);
            if (data) {
                if (data[0]) updateUI(data[0], false);
                data.reverse().forEach(addLog);
            }
        }

        function updateUI(d, log = true) {
            document.getElementById('disp-tipe').innerText = d.tipe;
            document.getElementById('disp-isi').innerText = `"${d.isi}"`;
            document.getElementById('disp-pembuat').innerText = "Oleh: " + d.pembuat;
            if (log) addLog(d);
        }

        function addLog(d) {
            const list = document.getElementById('log-list');
            const div = document.createElement('div');
            div.className = "bg-white/5 p-4 rounded-2xl border border-white/5";
            div.innerHTML = `<p class="text-[9px] font-black text-indigo-400 uppercase">${d.pembuat}</p><p class="text-[11px] opacity-70 italic">Memilih ${d.tipe}: "${d.isi}"</p>`;
            list.prepend(div);
        }
    </script>
</body>
</html>

